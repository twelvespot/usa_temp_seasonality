---
title: "Untitled"
format: html
---

Here we finally make the plot with plotly


```{python}
import pandas as pd
import polars as pl
import plotly.express as px
from urllib.request import urlopen
import json
```

Load up the fips counties, join to the temp data
```{python}
fips_counties = pl.read_parquet("./data/fips_counties.parquet")
county_seasons_counts = pl.read_parquet("./data/county_seasonality_counts.parquet")
county_all = fips_counties.join(county_seasons_counts, on=["state", "county"], how="inner")

county_all
```

Load up the shape info

```{python}
with urlopen('https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json') as response:
    counties = json.load(response)

counties["features"][0]
```

Plot away!

```{python}
usa_seasons_fig = px.choropleth(county_all, 
                                geojson=counties, locations='fips_code', color='seasonality_score',
                                color_continuous_scale="Viridis",
                                range_color=(0, 1),
                                scope="usa",
                                hover_name="county",
                                hover_data=["state", "seasonality_score", "Cold < 40", "Cool 40-59", "Warm 60-79", "Hot > 80"]
                          )
usa_seasons_fig.update_layout(margin={"r":0,"t":0,"l":0,"b":0})
usa_seasons_fig.update_layout(coloraxis_showscale=False)
usa_seasons_fig.show()
```


```{python}
hovertemplate=(
                                    '<b>State</b>: %{state}<br>'
                                )
```